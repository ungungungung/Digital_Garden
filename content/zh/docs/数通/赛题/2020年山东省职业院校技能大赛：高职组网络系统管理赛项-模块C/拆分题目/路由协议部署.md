---
title: 路由协议部署
---
6.路由协议部署
由于公司并购前的历史原因导致双方使用不同的 OSPF 进程，经由总部技术部统一规划后再做调整，现阶段使用暂时过渡方案，即使用静态路由、OSPF、RIP、BGP多协议组网，具体要求如下：
-  OSPF 进程号 10，规划单区域，区域 0（S3、S4、EG2）；
-  OSPF 进程号 20，规划多区域，区域 0（R1、R2），区域 2（R1、R2、R3）；
-  OSPF 进程号 30，规划单区域，区域 0（AC1、EG1）；
-  总部与 A 公司互联链路规划至区域 0，并且不允许新增 OSPF 进程；
-  为了方便管理，所有运行 OSPF 的设备 router-id 必须为 loopback 口地址;
-  S5、S6、S7 使用 RIP 协议，RIP 协议使用版本 2，并且关闭自动聚合；S5、S6、R1、R2 使用 BGP 协议，BGP 协议中 S5、S6 使用 AS 号100， R1、R2 使用 AS 号200，同 AS 号内使用 loopback 口建立 iBGP 邻居，不同 AS 号使用互联接口建立 eBGP 邻居;
-  各设备禁止重发布直连网段，以 Network 发布明细路由;
-  要求只允许在设备互联网段出现协议报文;
-  为了管理方便，所有路由协议都需要发布 Loopback 地址;
-  优化 OSPF 相关配置，以尽量加快 OSPF 收敛;
-  AC2/S4、EG1/EG2 间部署静态路由协议；
-  重发布路由进 OSPF 中使用类型 1。

```
# OSPF 进程号 30，规划单区域，区域 0（AC1、EG1）

# AC1
router ospf 30
router-id 11.1.0.204
y
network 11.1.0.204 0.0.0.0 area 0
network 195.1.10.0 0.0.0.255 area 0
network 195.1.20.0 0.0.0.255 area 0
network 195.1.30.0 0.0.0.255 area 0
network 10.1.0.0 0.0.0.3 area 0
exit

# EG1
router ospf 30
router-id 11.1.0.11
y
network 11.1.0.11 0.0.0.0 area 0
network 10.1.0.0 0.0.0.3 area 0
exit

```

```
# OSPF 进程号 10，规划单区域，,区域 0（S3、S4、EG2）

# EG2
router ospf 10
router-id 11.1.0.12
y
network 11.1.0.12 0.0.0.0 area 0
network 10.1.0.4 0.0.0.3 area 0
network 10.1.0.12 0.0.0.3 area 0
exit

# S3
router ospf 10
router-id 11.1.0.33
y
network 11.1.0.33 0.0.0.0 area 0
network 10.1.0.4 0.0.0.3 area 0
network 10.1.0.8 0.0.0.3 area 0
network 10.1.0.52 0.0.0.3 area 0
network 192.1.10.0 0.0.0.255 area 0
network 192.1.20.0 0.0.0.255 area 0
network 192.1.30.0 0.0.0.255 area 0
network 192.1.40.0 0.0.0.255 area 0
network 192.1.50.0 0.0.0.255 area 0
network 192.1.60.0 0.0.0.255 area 0
network 192.1.100.0 0.0.0.255 area 0
exit

# S4
router ospf 10
router-id 11.1.0.34
y
network 11.1.0.34 0.0.0.0 area 0
network 10.1.0.12 0.0.0.3 area 0
network 10.1.0.16 0.0.0.3 area 0
network 10.1.0.52 0.0.0.3 area 0
network 192.1.10.0 0.0.0.255 area 0
network 192.1.20.0 0.0.0.255 area 0
network 192.1.30.0 0.0.0.255 area 0
network 192.1.40.0 0.0.0.255 area 0
network 192.1.50.0 0.0.0.255 area 0
network 192.1.60.0 0.0.0.255 area 0
network 192.1.100.0 0.0.0.255 area 0
exit

```

```
# OSPF 进程号 20，规划多区域，区域 0（R1、R2），区域 2（R1、R2、R3）

# R1
router ospf 20
router-id 11.1.0.1
y
network 11.1.0.1 0.0.0.0 area 0
network 10.1.0.8 0.0.0.3 area 0
network 10.1.0.24 0.0.0.3 area 0
network 10.1.0.20 0.0.0.3 area 2
exit

# R2
router ospf 20
router-id 11.1.0.2
y
network 11.1.0.2 0.0.0.0 area 0
network 10.1.0.16 0.0.0.3 area 0
network 10.1.0.24 0.0.0.3 area 0
network 10.1.0.36 0.0.0.3 area 2
exit

# R3
router ospf 20
router-id 11.1.0.3
y
network 11.1.0.3 0.0.0.0 area 2
network 10.1.0.20 0.0.0.3 area 2
network 10.1.0.36 0.0.0.3 area 2
network 172.16.0.0 0.0.0.255 area 2
exit

```

```
# S5、S6、S7 使用 RIP 协议，RIP 协议使用版本 2，并且关闭自动聚合

# S5
router rip
version 2
no auto-summary
network 11.1.0.35 0.0.0.0
network 10.1.0.40 0.0.0.3
network 10.1.0.44 0.0.0.3
exit

# S6
router rip
version 2
no auto-summary
network 11.1.0.36 0.0.0.0
network 10.1.0.40 0.0.0.3
network 10.1.0.48 0.0.0.3
exit

# S7
router rip
version 2
no auto-summary
network 11.1.0.37 0.0.0.0
network 10.1.0.44 0.0.0.3
network 10.1.0.48 0.0.0.3
network 194.1.10.0 0.0.0.255
network 194.1.100.0 0.0.0.255
network 172.17.0.0 0.0.0.255
exit

```

```
# S5、S6、R1、R2 使用 BGP 协议，BGP 协议中 S5、S6 使用 AS 号100， R1、R2 使用 AS 号200，同 AS 号内使用 loopback 口建立 iBGP 邻居，不同 AS 号使用互联接口建立 eBGP 邻居

# S5
router bgp 100
neighbor 11.1.0.36 remote-as 100
neighbor 11.1.0.36 update-source Loopback 0
neighbor 10.1.0.29 remote-as 200
address-family ipv4
neighbor 10.1.0.29 activate
neighbor 10.1.0.29 next-hop-self
neighbor 11.1.0.36 activate
exit
exit

# S6
router bgp 100
neighbor 11.1.0.35 remote-as 100
neighbor 11.1.0.35 update-source Loopback 0
neighbor 10.1.0.33 remote-as 200
address-family ipv4
neighbor 10.1.0.33 activate
neighbor 10.1.0.33 next-hop-self
neighbor 11.1.0.35 activate
exit
exit

# R1
router bgp 200
neighbor 11.1.0.2 remote-as 200
neighbor 11.1.0.2 update-source Loopback 0
neighbor 10.1.0.30 remote-as 100
address-family ipv4
neighbor 10.1.0.30 activate
neighbor 10.1.0.30 next-hop-self
neighbor 11.1.0.2 activate
exit
exit

# R2
router bgp 200
neighbor 11.1.0.1 remote-as 200
neighbor 11.1.0.1 update-source Loopback 0
neighbor 10.1.0.34 remote-as 100
address-family ipv4
neighbor 10.1.0.34 activate
neighbor 10.1.0.34 next-hop-self
neighbor 11.1.0.1 activate
exit
exit

```

```
# 要求只允许在设备互联网段出现协议报文

# AC1
router ospf 30
passive-interface vlan 10
passive-interface vlan 20
passive-interface vlan 30
exit

# S3
router ospf 10
passive-interface vlan 10
passive-interface vlan 20
passive-interface vlan 30
passive-interface vlan 40
passive-interface vlan 50
passive-interface vlan 60
passive-interface vlan 100
exit

# S4
router ospf 10
passive-interface vlan 10
passive-interface vlan 20
passive-interface vlan 30
passive-interface vlan 40
passive-interface vlan 50
passive-interface vlan 60
passive-interface vlan 100
exit

# R3
router ospf 20
passive-interface vlan 160
exit

# S7
router rip
passive-interface vlan 10
passive-interface vlan 100
passive-interface vlan 200
exit

```

```
# 优化 OSPF 相关配置，以尽量加快 OSPF 收敛

ip ospf network point-to-point
# AC1
interface gigabitEthernet 0/1
ip ospf network point-to-point
exit

# EG1
interface gigabitEthernet 0/0
ip ospf network point-to-point
exit

# EG2
interface gigabitEthernet 0/0
ip ospf network point-to-point
exit
interface gigabitEthernet 0/1
ip ospf network point-to-point
exit

# S3
interface vlan 101
ip ospf network point-to-point
exit
interface gigabitEthernet 0/4
ip ospf network point-to-point
exit
interface gigabitEthernet 0/5
ip ospf network point-to-point
exit

# S4
interface vlan 101
ip ospf network point-to-point
exit
interface gigabitEthernet 0/4
ip ospf network point-to-point
exit
interface gigabitEthernet 0/5
ip ospf network point-to-point
exit

# R1
interface gigabitEthernet 0/0
ip ospf network point-to-point
exit
interface gigabitEthernet 0/1
ip ospf network point-to-point
exit
interface vlan 300
ip ospf network point-to-point
exit
interface vlan 200
ip ospf network point-to-point
exit

# R2
interface gigabitEthernet 0/0
ip ospf network point-to-point
exit
interface gigabitEthernet 0/1
ip ospf network point-to-point
exit
interface vlan 300
ip ospf network point-to-point
exit
interface vlan 200
ip ospf network point-to-point
exit

# R3
interface gigabitEthernet 0/0
ip ospf network point-to-point
exit
interface gigabitEthernet 0/1
ip ospf network point-to-point
exit
interface vlan 160
ip ospf network point-to-point
exit

```

```
# AC2/S4、EG1/EG2 间部署静态路由协议；
# 重发布路由进 OSPF 中使用类型 1

# S4
ip route 11.1.0.205 255.255.255.255 192.1.100.1
router ospf 10
redistribute static subnets metric-type 1
exit

# AC2
ip route 0.0.0.0 0.0.0.0 192.1.100.254

# EG1
ip route 0.0.0.0 0.0.0.0 197.1.0.2
router ospf 30
default-information originate metric-type 1
exit

# EG2
ip route 0.0.0.0 0.0.0.0 197.1.0.1
router ospf 10
default-information originate metric-type 1
exit

```